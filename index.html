<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>App Loader</title>
    <script src="https://unpkg.com/vue@3.4.21"></script>

    <style>
        body{
            background: #1a1a1ab6;
            color: white;
            overflow-y: auto;
        }

        body::-webkit-scrollbar {
            width: 0 !important;
            background: transparent !important;
            display: none !important;
        }

        .category-title {
            width: 800px;
            font-size: 20px;
            margin: 20px auto 10px;
            text-shadow: 0 0 5px rgba(100, 180, 255, 0.5);
            text-align: center;
            user-select: none;
            border-radius: 8px;
            padding: 8px 0;
        }

        .category-title:hover {
        background-color: #2d3748a4;
        transition: background-color 0.2s;
        }

        /* å¯åŠ¨å™¨æ ‡é¢˜æ ·å¼ */
        .launcher-title {
        font-size: 24px;
        margin-bottom: 20px;
        text-align: center;
        text-shadow: 0 0 10px rgba(100, 180, 255, 0.5);
        }

        /* è½¯ä»¶æŒ‰é’®ç½‘æ ¼å®¹å™¨ï¼ˆä»¥åæ”¾å¤šä¸ªæŒ‰é’®è‡ªåŠ¨æ’ç‰ˆï¼‰ */
        .app-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        justify-content: center;
        gap: 20px;
        max-width: 800px;
        margin: 0 auto;
        padding: 0 20px;
        }

        /* å•ä¸ªè½¯ä»¶æŒ‰é’®æ ·å¼ */
        .app-btn {
        position: relative; /* è®© pin-badge ç»å¯¹å®šä½ */
        width: 100px;
        height: 120px;
        background: #252525;
        border-radius: 12px;
        padding: 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        transition: transform 0.2s;
        user-select: none;
        }

        .status-btn {
        position: relative; /* è®© pin-badge ç»å¯¹å®šä½ */
        width: 100px;
        height: 60px;
        background: #252525;
        border-radius: 12px;
        padding: 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        transition: transform 0.2s;
        user-select: none;
        }

        .small-btn {
        position: relative; /* è®© pin-badge ç»å¯¹å®šä½ */
        width: 80px;
        height: 30px;
        background: #252525;
        border-radius: 12px;
        padding: 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        transition: transform 0.2s;
        user-select: none;
        }

        .pin-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 12px;
        }

        /* é¼ æ ‡æ‚¬æµ®æ•ˆæœ */
        .app-btn:hover {
        transform: scale(1.05);
        background: #2d3748;
        box-shadow: 0 0 15px rgba(100, 180, 255, 0.3);
        }

        .status-btn:hover {
        transform: scale(1.05);
        background: #2d3748;
        box-shadow: 0 0 15px rgba(100, 180, 255, 0.3);
        }

        .small-btn:hover {
        transform: scale(1.05);
        background: #2d3748;
        box-shadow: 0 0 15px rgba(100, 180, 255, 0.3);
        }

        /* å›¾æ ‡æ ·å¼ï¼ˆé€‚é…å›¾ç‰‡ï¼‰ */
        .app-icon {
        width: 48px;
        height: 48px;
        border-radius: 8px;
        margin-bottom: 10px;
        object-fit: cover;
        }

        /* è½¯ä»¶åç§°æ ·å¼ */
        .app-name {
        font-size: 13px;
        font-weight: 500;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 90px;
        }
        
        .search-container {
        max-width: 600px;
        margin: 0 auto 30px;
        padding: 0 20px;
        }

        .search-input {
        width: 100%;
        padding: 12px 16px;
        background: #252525;
        border: 1px solid #333;
        border-radius: 8px;
        color: white;
        font-size: 16px;
        outline: none;
        transition: border-color 0.2s;
        }

        .status-icon{
            font-size: 30px;
        }

        .status-grid{
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .search-input:focus {
        border-color: #8ab4f8;
        box-shadow: 0 0 0 2px rgba(138, 180, 248, 0.2);
        }

        /* å¸®åŠ©ä¿¡æ¯å¼¹çª—æ ·å¼ */
        .help-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .help-content {
            width: 90%;
            max-width: 500px;
            background: #252525;
            border-radius: 12px;
            padding: 20px 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .help-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 18px;
            cursor: pointer;
            user-select: none;
            color: #ccc;
        }

        .help-close:hover {
            color: white;
        }

        .help-content h3 {
            margin: 0 0 15px 0;
            color: #8ab4f8;
            text-align: center;
        }

        .help-content ul {
            margin: 0;
            padding-left: 20px;
            line-height: 1.8;
            font-size: 14px;
        }

        .help-content li {
            margin-bottom: 8px;
        }

        .help-content kbd {
            padding: 2px 6px;
            background: #333;
            border-radius: 4px;
            font-family: monospace;
            margin: 0 2px;
        }

        /* åŠ è½½æç¤º */
        .loading {
            text-align: center;
            font-size: 16px;
            color: #8ab4f8;
            margin: 20px 0;
        }
    </style>
</head>
<body>

    <div id="app">
        <div style="text-align:center; margin-top:0px;">
            <h1 class="launcher-title">Drawer | ç¨‹åºå</h1>
            <p>Software Launching Bar</p>
        </div>
        <p style="text-align:center; margin-bottom:10px; color:#ffffffb7; font-size: 14px; font-style: italic;">ç‚¹å‡»å›¾æ ‡æ‰“å¼€è½¯ä»¶ï¼ŒæŒ‰ ESC é”®å…³é—­ç¨‹åº</p>

        <!-- æœç´¢æ¡† -->
        <div class="search-container">
            <input 
            type="text" 
            v-model="searchQuery" 
            placeholder="æœç´¢è½¯ä»¶..." 
            class="search-input"
            >
        </div>

        <div class = "status-grid">
            <div class ="status-btn" @click="closeWindow()">
                <div class="status-icon">â†©ï¸</div>
                <div class="app-name">è¿”å›</div>
            </div>
            <div class ="status-btn" @click="showHelp = !showHelp">
                <div class="status-icon" >â„¹ï¸</div>
                <div class="app-name">å¸®åŠ©ä¿¡æ¯</div>
            </div>
            <div class ="status-btn" @click="openAppFolder()">
                <div class="status-icon" >ğŸ“</div>
                <div class="app-name">ç®¡ç†åº”ç”¨</div>
            </div>
        </div>

        <!-- åŠ è½½æç¤º -->
        <div class="loading" v-if="isLoading">æ­£åœ¨åŠ è½½åº”ç”¨åˆ—è¡¨...</div>

        <!-- å¤–å±‚å¾ªç¯ï¼šéå†æ‰€æœ‰åˆ†ç±» -->
        <div v-for="category in filteredCategories" :key="category.CategoryName" v-if="!isLoading">

        <!-- ç‚¹å‡»è¿™é‡Œï¼Œåˆ‡æ¢å±•å¼€/æ”¶èµ· -->
        <div 
            class="category-title" 
            @click="category.expanded = !category.expanded"
        >
            {{ category.CategoryName }}
            <!-- å¯é€‰ï¼šåŠ ä¸ªå°ç®­å¤´æ˜¾ç¤ºçŠ¶æ€ -->
            <span style="margin-left:8px">{{ category.expanded ? 'ğŸ”½' : 'â—€ï¸' }}</span>
        </div>

        <!-- å…³é”®ï¼šåªæœ‰ expanded = true æ‰æ˜¾ç¤º app-grid -->
        <div class="app-grid" v-if="category.expanded">
            <div 
        class="app-btn" 
        v-for="app in category.apps" 
        :key="app.shortcutKey"
        @click="openApp(app.shortcutKey)"
        >
        <img class="app-icon" :src="app.icon" :alt="app.name">
        <div class="app-name">{{ app.name }}</div>
        </div>
        </div>

        </div>
<!-- å¸®åŠ©ä¿¡æ¯å¼¹çª—ï¼ˆé‡å†™ç‰ˆï¼‰ -->
<div class="help-modal" v-if="showHelp">
    <div class="help-content" v-if="!showabout">
        <div class="help-close" @click="showHelp = false">âœ•</div>
        <h3>ğŸ“Œ Drawer Instructions</h3>
        
        <div class="help-section">
            <h4>ğŸ” åŸºç¡€æ“ä½œ</h4>
            <ul>
                <li><strong>æœç´¢è½¯ä»¶</strong> â€“ é¡¶éƒ¨æœç´¢æ¡†å®æ—¶è¿‡æ»¤ï¼Œå¿«é€Ÿå®šä½åº”ç”¨</li>
                <li><strong>æŠ˜å åˆ†ç±»</strong> â€“ ç‚¹å‡»åˆ†ç±»æ ‡é¢˜ï¼ˆå¦‚â€œç¼–ç¨‹å·¥å…·â€ï¼‰å¯å±•å¼€/æ”¶èµ·è¯¥ç»„åº”ç”¨</li>
                <li><strong>å¯åŠ¨åº”ç”¨</strong> â€“ å•å‡»å›¾æ ‡å³å¯å¯åŠ¨ï¼Œå¯åŠ¨åè‡ªåŠ¨å…³é—­ç¨‹åºå</li>
                <li><strong>é€€å‡ºç¨‹åº</strong> â€“ ç‚¹å‡»ã€Œè¿”å›ã€æŒ‰é’®æˆ–æŒ‰ <kbd>ESC</kbd> é”®</li>
            </ul>
        </div>

        <div class="help-section">
            <h4>ğŸ“ ç®¡ç†åº”ç”¨</h4>
            <ul>
                <li><strong>æ‰“å¼€ App æ–‡ä»¶å¤¹</strong> â€“ ç‚¹å‡»åº•éƒ¨ã€Œç®¡ç†åº”ç”¨ã€æŒ‰é’®ï¼ˆğŸ“ï¼‰ï¼Œä¼šæ‰“å¼€æ–‡ä»¶å¤¹å¹¶è‡ªåŠ¨é€€å‡ºç¨‹åºã€‚ä½ å¯ä»¥åœ¨å…¶ä¸­æ–°å»ºæ–‡ä»¶å¤¹ï¼ˆä½œä¸ºåˆ†ç±»ï¼‰åæ”¾å…¥ <code>.lnk</code> å¿«æ·æ–¹å¼ï¼Œæˆ–è€…åœ¨å·²æœ‰çš„æ–‡ä»¶å¤¹ä¸­æ”¾å…¥<code>.lnk</code> å¿«æ·æ–¹å¼ï¼Œé‡å¯ç¨‹åºåè‡ªåŠ¨ç”Ÿæ•ˆã€‚</li>
                <li><strong>å›¾æ ‡è‡ªåŠ¨æå–</strong> â€“ æ¯æ¬¡å¯åŠ¨ç¨‹åºéƒ½ä¼šè‡ªåŠ¨ä»å¿«æ·æ–¹å¼çš„ç›®æ ‡æ–‡ä»¶ä¸­æå–æœ€æ–°å›¾æ ‡ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚</li>
                <li><strong style="color: red;">æ³¨æ„</strong> â€“ æ–‡ä»¶å¤¹ä»…ä½œä¸ºä¸€æ¬¡åˆ†ç±»ï¼Œä¸å¯å †å ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´å›¾æ ‡æå–å¤±è´¥æˆ–ç¨‹åºåæ— æ³•è¯†åˆ«åº”ç”¨ï¼›æ­£ç¡®çš„åšæ³•æ˜¯ï¼šæ¯ä¸ªåˆ†ç±»æ–‡ä»¶å¤¹ä¸‹åªåŒ…å«ä¸€ä¸ªå±‚çº§çš„å¿«æ·æ–¹å¼ã€‚</li>
            </ul>
        </div>

        <div class="help-section">
            <h4>ğŸ’¡ å°è´´å£«</h4>
            <ul>
                <li>æ‰€æœ‰æŒ‰é’®æ‚¬æµ®æ—¶æœ‰ç¼©æ”¾æ•ˆæœï¼Œç•Œé¢æ»šåŠ¨æ¡å·²éšè—ï¼ˆä»å¯ç”¨æ»šè½®æ»šåŠ¨ï¼‰ã€‚</li>
                <li>å¦‚æœä½ ä¿®æ”¹äº† App æ–‡ä»¶å¤¹å†…çš„å†…å®¹ï¼ˆå¢åˆ åˆ†ç±»æˆ–å¿«æ·æ–¹å¼ï¼‰ï¼Œåªéœ€é‡å¯ç¨‹åºå³å¯åŒæ­¥æ›´æ–°ã€‚</li>
            </ul>
        </div>

        <p class="help-footer">âœ¨ å¦‚æœ‰é—®é¢˜ï¼Œå¯å†æ¬¡æ‰“å¼€æœ¬å¸®åŠ©ã€‚</p>
        <div class = "small-btn" @click="showabout = !showabout">å…³äº</div>
    </div>
    <div class="help-content" v-else>
        <div class="help-close" @click="showHelp = false ; showabout = false">âœ•</div>
        <h3>å…³äº Drawer</h3>
        <p>ç‰ˆæœ¬ï¼š1.3.0</p>
        <p>ä½œè€…ï¼šAs_Val</p>
        <p>æ¨èé…ç½®ï¼šWindows 11</p>
        <p>è¿™æ˜¯ä¸€ä¸ªåŸºäº Electron å’Œ Vue.js çš„ç®€æ˜“ç¨‹åºå¯åŠ¨å™¨ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªå¿«é€Ÿè®¿é—®å¸¸ç”¨åº”ç”¨çš„ç•Œé¢ã€‚æ‰€æœ‰å›¾æ ‡å’Œåº”ç”¨ä¿¡æ¯å‡æ¥è‡ªç”¨æˆ·æŒ‡å®šçš„å¿«æ·æ–¹å¼æ–‡ä»¶å¤¹ï¼Œæ”¯æŒè‡ªå®šä¹‰åˆ†ç±»å’Œæœç´¢åŠŸèƒ½ã€‚</p>
        <p>å¦‚æœä½ å–œæ¬¢è¿™ä¸ªé¡¹ç›®ï¼Œæ¬¢è¿åœ¨ GitHub ä¸Šç»™æˆ‘ç‚¹ä¸ªèµ â­ï¸ï¼</p>
        <p><strong>è¯·æ³¨æ„ï¼š</strong>æœ¬ç¨‹åºæœ‰ä¸€å®šçš„äººå·¥æ™ºèƒ½ååŠ©</p>
        <div class = "small-btn" @click="showabout = !showabout">è¿”å›å¸®åŠ©</div>
    </div>
</div>
    </div>

    <script>
    // æå‰å¼•å…¥ electronï¼Œé¿å…åŠ¨æ€æ³¨å…¥å¯¼è‡´çš„è­¦å‘Š
        const { ipcRenderer } = require('electron');

        Vue.createApp({
        data() {
            return {
            showabout:false,
            searchQuery: '',
            showHelp: false,
            appCategories: [],
            isLoading: true
            }
        },

        async mounted() {
            try {
            // è¯»å– JSON é…ç½®ï¼ˆåŠ ç¼“å­˜æ¸…ç†ï¼‰
            const config = await fetch('./app-config.json?' + Date.now())
                .then(res => {
                if (!res.ok) throw new Error('é…ç½®æ–‡ä»¶è¯»å–å¤±è´¥');
                return res.json();
                });
            this.appCategories = config;
            } catch (err) {
            alert('åŠ è½½åº”ç”¨åˆ—è¡¨å¤±è´¥ï¼š' + err.message);
            console.error('åŠ è½½é…ç½®å¤±è´¥ï¼š', err);
            } finally {
            this.isLoading = false;
            }
        },

        methods: {
            // ç›´æ¥ç”¨ ipcRendererï¼Œé¿å… window.electron å¯¼è‡´çš„å…‹éš†é”™è¯¯
            openApp(shortcutKey) {
            ipcRenderer.invoke('open-app', shortcutKey)
                .then((result) => {
                if (!result) alert('æ‰“å¼€å¤±è´¥ï¼æ£€æŸ¥å¿«æ·æ–¹å¼æ˜¯å¦å­˜åœ¨');
                this.closeWindow();
                })
                .catch((err) => {
                alert('å‡ºé”™äº†ï¼š' + err.message);
                });
            },

            closeWindow() {
            try {
                window.close();
            } catch (err) {
                alert('å…³é—­çª—å£å‡ºé”™ï¼š' + err.message);
            }
            },

            openAppFolder() {
                ipcRenderer.invoke('open-app-folder').then(result => {
                    if (!result) alert('æ‰“å¼€æ–‡ä»¶å¤¹å¤±è´¥ï¼');
                }).catch(err => {
                    alert('å‡ºé”™äº†ï¼š' + err.message);
                });
                this.closeWindow();
            },
        },

        created() {
            document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                this.closeWindow();
            }
            });

            // æ•è·æ¸²æŸ“è¿›ç¨‹æœªå¤„ç†çš„å¼‚å¸¸
            window.addEventListener('error', (err) => {
            console.error('é¡µé¢å¼‚å¸¸ï¼š', err.message);
            });
        },

        computed: {
            filteredCategories() {
            const q = this.searchQuery.trim().toLowerCase();
            if (!q) return this.appCategories;

            return this.appCategories.map(cat => {
                const filteredApps = cat.apps.filter(app => 
                app.name.toLowerCase().includes(q)
                );
                return { ...cat, apps: filteredApps };
            }).filter(cat => cat.apps.length);
            }
        },
        }).mount('#app');
    </script>
</body>
</html>